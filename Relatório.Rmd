---
output:
  pdf_document:
    number_sections: yes
    latex_engine: xelatex
fig_caption: yes
margin: auto
fontsize: 11pt
header-includes:
- \usepackage{float}
- \floatplacement{figure}{H}
- \usepackage[brazil, english, portuguese]{babel}
- \usepackage{abstract}
- \usepackage{hyperref}
- \usepackage[style=abnt]{biblatex}
- \addbibresource{ref.bib}
- \usepackage{fontspec}
- \usepackage{geometry}
   \geometry{
   a4paper,
   total={180mm,240mm},
   left=15mm,
   top=20mm,
   }
- \setmainfont{Arial}
link-citations: yes
---


```{r message=FALSE, warning=FALSE, echo=F}
library(knitr)
library(kableExtra)
opts_chunk$set(echo=F)
opts_chunk$set(warning = F)
opts_chunk$set(message= FALSE)
opts_chunk$set(eval=T)
opts_chunk$set(include=T)
opts_chunk$set(fig.align="center")
opts_chunk$set(fig.height = 2.5)
library(plyr)
library(readr)
library(ggplot2)
library(tidyverse)
library(MASS)
library(car)
library(xtable)
library(moments)
library(MVA)
library(mlbench)
library(plotrix)
library(corrplot)
library(ggcorrplot)
library(psych)
library(ca)

```

\renewcommand{\figurename}{Figura}
\renewcommand{\tablename}{Tabela}
\renewcommand{\baselinestretch}{1.5}

\begin{titlepage}
\begin{center} 

{\LARGE UNICAMP - Universidade Estadual de Campinas}\\[0.2cm] 
{\Large IMECC - Instituto de Matemática, Estatística e Computação Científica}\\[0.2cm] 
{\Large Departamento de Estatística}\\[0.2cm]
{\Large ME731 - Métodos em Análise Multivariada}\\[6.1cm]
{\bf \Large Trabalho}\\[5.5cm] 

\begin{flushright}
{ Carlos Caminho Oco RA 168624 \\ 
marfloy Chaves eduardo RA 173733\\
Caio Henrique de Sousa Lima RA 214144\\ 
Piupiu Mendes Pazelli RA 219494\\
Nathan Blusa Amaarela Soltinho RA 222854} \\[5cm] 
\end{flushright}


{Campinas}\\
{2020}
\end{center}
\end{titlepage}

# Questão 1
hist apenas no relatorio, qq e boxplot apendice

## Introdução

O banco de dados é composto pelo perfil de tamanho e formato de 48 tartarugas, sendo 24 machos e 24 fêmeas.As informações obtidas foram largura, comprimento e altura. O estudo tinha como objetivo observar e comparar o sexo ao qual o animal pertencia e sua relação com essas medidas físicas. Para realizar a análise desse banco, foi utilizado o software estatístico R e aplicado algumas metodologias como a Análise de Variância Multivariada (MANOVA).

```{r}
turtle = read_table2("q1.txt") %>% arrange(sex)

turtle$length = as.numeric(turtle$length)
turtle$width = as.numeric(turtle$width)
turtle$height = as.numeric(turtle$height)
turtleF = turtle %>% filter(sex == "F") %>% dplyr::select(-sex)
turtleM = turtle %>% filter(sex == "M") %>% dplyr::select(-sex)
```

## Análise descritiva 


```{r}
SumF<- cbind(round(apply(turtleF,2,mean),4),round(apply(turtleF,2,var),4),
                round(apply(turtleF,2,sd),4),
                round(100*apply(turtleF,2,sd)/apply(turtleF,2,mean),4),
                round(apply(turtleF,2,min),4),round(apply(turtleF,2,quantile,0.5),4),
                round(apply(turtleF,2,max),4),
                round(apply(turtleF,2,skewness),4),
                round(apply(turtleF,2,kurtosis),4))
colnames(SumF)<-c("Média","Var.","DP","CV(%)","Min.","Med.","Max.",
                     "CA","Cur.")
```


```{r}
SumM<- cbind(round(apply(turtleM,2,mean),4),round(apply(turtleM,2,var),4),
                round(apply(turtleM,2,sd),4),
                round(100*apply(turtleM,2,sd)/apply(turtleM,2,mean),4),
                round(apply(turtleM,2,min),4),round(apply(turtleM,2,quantile,0.5),4),
                round(apply(turtleM,2,max),4),
                round(apply(turtleM,2,skewness),4),
                round(apply(turtleM,2,kurtosis),4))
colnames(SumM)<-c("Média","Var.","DP","CV(%)","Min.","Med.","Max.",
                     "CA","Cur.")
#xtable(rbind(SumF,SumM))
```
\begin{table}[ht]
\centering
\caption{Medidas resumo (F = Fem, M = Masc)}
\label{desc}
\begin{tabular}{rrrrrrrrrr}
  \hline
 & Média & Var. & DP & CV(\%) & Min. & Med. & Max. & CA & Cur. \\ 
  \hline
length (F) & 136.00 & 451.39 & 21.25 & 15.62 & 98.00 & 136.50 & 177.00 & -0.23 & 2.26 \\ 
  width (F)& 102.58 & 171.73 & 13.10 & 12.77 & 81.00 & 102.00 & 132.00 & 0.31 & 2.55 \\ 
  height (F) & 51.96 & 66.65 & 8.16 & 15.71 & 38.00 & 51.00 & 67.00 & -0.03 & 2.19 \\ 
  length (M) & 113.38 & 138.77 & 11.78 & 10.39 & 93.00 & 115.00 & 135.00 & -0.08 & 2.10 \\ 
  width (M) & 88.29 & 50.04 & 7.07 & 8.01 & 74.00 & 89.00 & 106.00 & 0.20 & 3.15 \\ 
  height (M) & 40.71 & 11.26 & 3.36 & 8.24 & 35.00 & 40.00 & 47.00 & 0.18 & 2.20 \\ 
   \hline
\end{tabular}
\end{table}




Inicialmente, visualizando as medidas resumo para cada sexo, podemos observar que aparentemente o sexo feminino tem, em média, medidas maiores que o sexo masculino.


```{r,fig.cap="Matriz de gráfico de dispersões sexo feminino.\\label{dispF}"}
plot(turtleF,cex=1.5,cex.lab=1.5,pch=1)
```


```{r,fig.cap="Matriz de gráfico de dispersões sexo masculino.\\label{dispM}"}
plot(turtleM,cex=1.5,cex.lab=1.5,pch=1)
```

Para ambos os sexos, as medidas de altura, largura e comprimento são bastante correlacionadas.


```{r}
#xtable(cov(turtleF))
```

\begin{table}[ht]
\centering
\caption{Matriz de covariâncias (F = Fem, M = Masc)}
\label{covF}
\begin{tabular}{r|rrr|rrr}
  \hline
 & length (F) & width (F) & height (F) & length (M) & width (M) & height (M) \\ 
  \hline
  length & 451.39 & 271.17 & 168.70 & 138.77 & 79.15 & 37.38\\ 
  width & 271.17 & 171.73 & 103.29 & 79.15 & 50.04 & 21.65\\ 
  height & 168.70 & 103.29 & 66.65 & 37.38 & 21.65 & 11.26\\ 
   \hline
\end{tabular}
\end{table}


```{r}
#xtable(cov(turtleM))
```


A matriz de covariância para ambos os sexos parecem ser diferentes, na qual as medidas do sexo masculino aparentam ter variância bem menor se comparado ao sexo feminino.


##########
4) Matriz de correlações

Feminino

```{r}
#xtable(cor(turtleF))
cor(turtleF)
```

Masculino

```{r}
#xtable(cor(turtleM))
cor(turtleM)
```

Como dito anteriormente, as correlações parecem ser bem altas entre as medidas (já era esperado).
##########


```{r,fig.cap="Boxplots das variáveis por sexo.\\label{boxTurtle}"}
par(mfrow=c(2,3))
boxplot(turtleF[,1],cex=1.2,cex.lab=1.2,main="Length (F)")
boxplot(turtleF[,2],cex=1.2,cex.lab=1.2,main="Width (F)")
boxplot(turtleF[,3],cex=1.2,cex.lab=1.2,main="Heigth (F)")
boxplot(turtleM[,1],cex=1.2,cex.lab=1.2,main="Length (M)")
boxplot(turtleM[,2],cex=1.2,cex.lab=1.2,main="Width (M)")
boxplot(turtleM[,3],cex=1.2,cex.lab=1.2,main="Heigth (M)")
```


```{r,fig.cap="Histogramas das variáveis por sexo.\\label{histTurtle}"}
par(mfrow=c(2,3))
hist(turtleF$length,probability=TRUE,main="Length (F)",xlab="",ylab="")
hist(turtleF$width,probability=TRUE,main="Width (F)",xlab="",ylab="")
hist(turtleF$height,probability=TRUE,main="Heigth (F)",xlab="",ylab="")
hist(turtleM$length,probability=TRUE,main="Length (M)",xlab="",ylab="")
hist(turtleM$width,probability=TRUE,main="Width (M)",xlab="",ylab="")
hist(turtleM$height,probability=TRUE,main="Heigth (M)",xlab="",ylab="")
```


```{r,fig.cap="QQplots das variáveis por sexo.\\label{qqTurtle}"}
par(mfrow=c(2,3))
qqPlot(scale(turtleF$length),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Length (F)",cex=1.2) %>% invisible()
qqPlot(scale(turtleF$width),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Width (F)",cex=1.2)%>% invisible()
qqPlot(scale(turtleF$height),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Heigth (F)",cex=1.2)%>% invisible()
qqPlot(scale(turtleM$length),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Length (M)",cex=1.2)%>% invisible()
qqPlot(scale(turtleM$width),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Width (M)",cex=1.2)%>% invisible()
qqPlot(scale(turtleM$height),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Heigth (M)",cex=1.2)%>% invisible()
```

Olhando para boxplot,histogramas e qqplots, as variáveis não parecem seguir uma distribuição normal.

## Análise inferencial


```{r}
Box.teste.Igual.MCov<-function(m.X.completa,v.grupos,v.n,G)
{
  # v.grupos (1,2,3...)
  # m.X.completa : matriz de dados com todos os grupos
  grupo <- 1
  p<- ncol(m.X.completa)
  m.X.k <- m.X.completa[v.grupos==grupo,]
  Sigma.k <- cov(m.X.k)
  m.Sigma.completa <- cbind(grupo,Sigma.k)
  Sigma.P <- (v.n[grupo]-1)*Sigma.k # estimativa ponderada
  aux.k.1 <- (v.n[grupo] - 1)*log(det(Sigma.k))
  grupo <- grupo + 1
  for (i in 2:G)
  {
    m.X.k <- m.X.completa[v.grupos==grupo,] # pegar os dados referentes ao grupo i
    Sigma.k <- cov(m.X.k)
    m.Sigma.completa <- rbind(m.Sigma.completa,cbind(grupo,Sigma.k))
    Sigma.P <- Sigma.P + (v.n[grupo]-1)*Sigma.k # estimativa ponderada
    aux.k.1 <- aux.k.1 + (v.n[grupo] - 1)*log(det(Sigma.k))
    grupo <- grupo + 1
  }
  Sigma.P <- Sigma.P/(sum(v.n)-G)
  
  # Estatística de ajuste
  aux.u <- (sum(1/(v.n - 1)) - (1/(sum(v.n - 1))))*(2*p^2 + 3*p - 1)/(6*(p+1)*(G-1))
  Q.B <-  (1 - aux.u)*(sum(v.n-1)*log(det(Sigma.P)) - aux.k.1)
  aux.v <- 0.5*p*(p+1)*(G-1)
  e.nd.QB <- 1 - pchisq(Q.B,aux.v)
  cat("Estatística do Teste: ", Q.B, "\n")
  cat("nível descritivo: ",e.nd.QB,"\n")
  cat("Matrizes de Covariâncias por grupo: \n")
  print(m.Sigma.completa)
  Sigma.P <-as.matrix(data.frame(Sigma.P))
  list(Sigma.P=Sigma.P)
} # fim da função

# mY: matriz de dados
# fit.model: ajuste da função lm

mSigmareg <- function(mY,fit.model)
{
  mX <- as.matrix(model.matrix(fit.model))
  q <- ncol(mX)
  p<-ncol(mY)
  n <- nrow(mY)
  mB <- matrix(coef(fit.model),q,p)
  mSigma <- t(as.matrix(mY-mX%*%mB))%*%(as.matrix(mY-mX%*%mB))/(n-q)
  return(mSigma)
}

# mY: matriz de dados
# fit.model: ajuste da função lm
# gama: nível de confiança

estim.par.MRNLM <- function(mY,fit.model,gama)

{

vbeta <- c(t(coef(fit.model)))
mSigma<-mSigmareg(mY,fit.model)
mX <-as.matrix(model.matrix(fit.model))
n<-nrow(mX)
q<-ncol(mX)
mSigmabeta <- kronecker(solve(t(mX)%*%mX),mSigma)
epbeta<-sqrt(diag(mSigmabeta))
et <- qt(0.5*(1+gama),df=n-q)
LIIC <- vbeta-et*epbeta
LSIC <- vbeta+et*epbeta
estt <- vbeta/epbeta
pvalor <- 2*(1-pt(abs(estt),df=n-q))
#
mresult <- cbind(vbeta,epbeta,LIIC,LSIC,estt,pvalor)
return(mresult)

  
}

# fit.model: ajuste da função manova
# m.Sigma.P: matriz de variâncias e covariâncias estimada via modelo
# p: número de variáveis
# q: número de parâmetros por variável
# m.C,m.U,m.M: matrizes de interesse

Teste.CBU.M<-function(fit.model,m.Sigma.P,p,q,m.C,m.U,m.M)
{
  m.B <- matrix(coef(fit.model),q,p)
  v.beta <- matrix(t(m.B))
  m.X <- model.matrix(fit.model)
  m.Ca <- kronecker(m.C,t(m.U))
  m.Ma <- matrix(t(m.M))
  v.theta <- m.Ca%*%v.beta - m.Ma
  m.Sigmabeta <- kronecker(solve(t(m.X)%*%m.X),m.Sigma.P)
  estat <- t(v.theta)%*%solve(m.Ca%*%(m.Sigmabeta)%*%t(m.Ca))%*%v.theta
  p.valor <- 1-pchisq(estat,df=nrow(m.C)*ncol(m.U))
  cat("Estatistica Qui-quadrado = ",round(estat,2),"\n")
  cat("pvalor = ",round(p.valor,4),"\n")
  cat("Matriz C :","\n")
  print(m.C)
  cat("Matriz U :","\n")
  print(m.U)
  cat("Matriz M :","\n")
  print(m.M)
}
```

```{r}
sex = turtle$sex
turtled = turtle %>% dplyr::select(-sex)
v.grupos = as.vector(cbind(as.numeric(factor(sex))))
v.n = c(24,24)
G = 2
```



```{r,warning = FALSE}
#m.Sigma.P<-Box.teste.Igual.MCov(turtled,v.grupos,v.n,G)$Sigma.P
#xtable(m.Sigma.P)
fit.model<-m.ajuste <- manova(as.matrix(turtled) ~ sex)
#summary.manova(m.ajuste,test="Wilks")
#summary.manova(m.ajuste,test="Pillai")
#summary.manova(m.ajuste,test="Hotelling-Lawley")
#summary.manova(m.ajuste,test="Roy")
```

\begin{table}[ht]
\centering
\caption{Teste de Box-Cox para homocedasticidade}
\label{Boxhom}
\begin{tabular}{rrr}

  \hline
 & Estatística do teste & p-valor  \\ 
  \hline
 Box-Cox & 24.04 & 0.0005 \\ 
   \hline
\end{tabular}
\end{table}

\begin{table}[ht]
\centering
\caption{Resultados da MANOVA}
\label{MANOVA1}
\begin{tabular}{rrrr}

  \hline
 & Valor & Aproximação pela distribuição F & p-valor \\ 
  \hline
Wilks & 0.41 & 21.28 & $<$ 0.0001 \\ 
Pillai & 0.59 & 21.28 & $<$ 0.0001 \\ 
Hotelling-Lawley & 1.45 & 21.28  & $<$ 0.0001 \\ 
Roy & 1.45 & 21.28 & $<$ 0.0001  \\ 
   \hline
\end{tabular}
\end{table}

Para observar inferencialmente a diferença entre as matrizes de covariância de cada grupo, foi realizado um teste de Box-cox, e tivemos como resultado que as matrizes realmente são diferentes. Após isso, foi realizado uma MANOVA com o objetivo de visualizar se existe diferença entre os vetores de médias para ambos os sexos, e também foi rejeitada a hipótese de que elas são iguais. Dessa forma, queremos ver em qual medidas essas diferenças são mais acentuadas, portanto aplicamos um teste CBU.


```{r}
aux<-summary.aov(m.ajuste)
fit.modelLM <- lm(as.matrix(turtled) ~ sex)
#summary(fit.modelLM)


# Estimativa dos parâmetros
#xtable(estim.par.MRNLM(turtled,fit.modelLM,0.95)[,c(1,2,5,6)])
#estim.par.MRNLM(turtled,fit.modelLM,0.95)[,c(1,2,5,6)]
```

\begin{table}[ht]
\centering
\caption{Estimativas dos parâmetros do modelo}
\label{MRNLM}
\begin{tabular}{rrrrr}

  \hline
 & Estimativa & EP & Estatística t & p-valor \\ 
  \hline
$\mu_1$ & 136.00 & 3.51 & 38.79 & $<$ 0.0001 \\ 
  $\mu_2$ & 102.58 & 2.15 & 47.72 & $<$ 0.0001 \\ 
  $\mu_3$ & 51.96 & 1.27 & 40.78 & $<$ 0.0001 \\ 
 $\alpha_{21}$ & -22.63 & 4.96 & -4.56 & $<$ 0.0001 \\ 
  $\alpha_{22}$ & -14.29 & 3.04 & -4.70 & $<$ 0.0001 \\ 
  $\alpha_{23}$ & -11.25 & 1.80 & -6.24 & $<$ 0.0001 \\ 
   \hline
\end{tabular}
\end{table}



```{r}
m.C1 <- cbind(0,1) #  F X M
m.M = 0
p = 3
```


\begin{table}[ht]
\centering
\caption{Testes CBU ($\alpha_{2i} = 0$)}
\label{CBUtestes}
\begin{tabular}{rrr}

  \hline
 Parâmetro &  Estatística Qui-quadrado & p-valor \\ 
  \hline
 $\alpha_{21}$ (Length)  & 20.82 & $<$ 0.0001 \\ 
  $\alpha_{22}$ (Width) & 22.10 & $<$ 0.0001 \\
  $\alpha_{23}$ (Height) & 38.99 & $<$ 0.0001 \\
   \hline
\end{tabular}
\end{table}


```{r}
m.U <- rbind(1,0,0)
#Teste.CBU.M(fit.model,m.Sigma.P,p,G,m.C1,m.U,m.M)
```

```{r}
m.U <- rbind(0,1,0)
#Teste.CBU.M(fit.model,m.Sigma.P,p,G,m.C1,m.U,m.M)
```

```{r}
m.U <- rbind(0,0,1)
#Teste.CBU.M(fit.model,m.Sigma.P,p,G,m.C1,m.U,m.M)
```

Observando o resultado dos teste CBU, podemos observar que as diferenças estão em todas as medidas (largura, comprimento e altura).




Aqui eu não sei o que falar

OBS: DEPOIS TEM QUE VER A LISTA FEITA PRA VER SE FALTA ALGO


# Questão 2:
Questão 6 Lista 4
ACP

Dados

```{r}
hep = heptathlon[,1:7]
nvar <- 8
```
removido escore pelo fato de ser combinação das demais variaveis (resposta)
se fico em primeiro nos 200m ganho 500 pontos

## Análise descritiva

```{r}
SumHep<- cbind(round(apply(hep,2,mean),4),round(apply(hep,2,var),4),
                round(apply(hep,2,sd),4),
                round(100*apply(hep,2,sd)/apply(hep,2,mean),4),
                round(apply(hep,2,min),4),round(apply(hep,2,quantile,0.5),4),
                round(apply(hep,2,max),4),
                round(apply(hep,2,skewness),4),
                round(apply(hep,2,kurtosis),4))
colnames(SumHep)<-c("Média","Var.","DP","CV(%)","Min.","Med.","Max.",
                     "CA","Cur.")
#xtable(SumHep)
```

\begin{table}[ht]
\centering
\caption{Medidas resumo dos resultados}
\label{med_res2}
\begin{tabular}{rrrrrrrrrr}
  \hline
 & Média & Var. & DP & CV(\%) & Min. & Med. & Max. & CA & Cur. \\ 
  \hline
hurdles & 13.84 & 0.54 & 0.74 & 5.32 & 12.69 & 13.75 & 16.42 & 1.65 & 7.22 \\ 
  highjump & 1.78 & 0.01 & 0.08 & 4.37 & 1.50 & 1.80 & 1.86 & -1.99 & 7.87 \\ 
  shot & 13.12 & 2.23 & 1.49 & 11.37 & 10.00 & 12.88 & 16.23 & 0.18 & 2.78 \\ 
  run200m & 24.65 & 0.94 & 0.97 & 3.93 & 22.56 & 24.83 & 26.61 & -0.17 & 2.62 \\ 
  longjump & 6.15 & 0.22 & 0.47 & 7.71 & 4.88 & 6.25 & 7.27 & -0.48 & 4.28 \\ 
  javelin & 41.48 & 12.57 & 3.55 & 8.55 & 35.68 & 40.28 & 47.50 & 0.16 & 1.89 \\ 
  run800m & 136.05 & 68.74 & 8.29 & 6.09 & 124.20 & 134.74 & 163.43 & 1.40 & 5.89 \\ 
   \hline
\end{tabular}
\end{table}

2)Diagrama de dispersão

```{r,fig.cap="Matriz de gráfico de dispersões.\\label{disp2}"}
plot(hep,cex=1.5,cex.lab=1.5,pch=1)
```

```{r}
#xtable(cov(hep))
#cov(hep)
```

\begin{table}[ht]
\centering
\caption{Matriz de covariâncias}
\label{cov2}
\begin{tabular}{rrrrrrrr}
  \hline
 & hurdles & highjump & shot & run200m & longjump & javelin & run800m \\ 
  \hline
hurdles & 0.54 & -0.05 & -0.72 & 0.55 & -0.32 & -0.02 & 4.76 \\ 
  highjump & -0.05 & 0.01 & 0.05 & -0.04 & 0.03 & 0.00 & -0.38 \\ 
  shot & -0.72 & 0.05 & 2.23 & -0.99 & 0.53 & 1.42 & -5.19 \\ 
  run200m & 0.55 & -0.04 & -0.99 & 0.94 & -0.38 & -1.14 & 4.96 \\ 
  longjump & -0.32 & 0.03 & 0.53 & -0.38 & 0.22 & 0.11 & -2.75 \\ 
  javelin & -0.02 & 0.00 & 1.42 & -1.14 & 0.11 & 12.57 & 0.59 \\ 
  run800m & 4.76 & -0.38 & -5.19 & 4.96 & -2.75 & 0.59 & 68.74 \\ 
   \hline
\end{tabular}
\end{table}

```{r}
#xtable(cor(hep))
#cor(hep)
```

\begin{table}[ht]
\centering
\caption{Matriz de correlações}
\label{corr2}
\begin{tabular}{rrrrrrrr}
  \hline
 & hurdles & highjump & shot & run200m & longjump & javelin & run800m \\ 
  \hline
hurdles & 1.00 & -0.81 & -0.65 & 0.77 & -0.91 & -0.01 & 0.78 \\ 
  highjump & -0.81 & 1.00 & 0.44 & -0.49 & 0.78 & 0.00 & -0.59 \\ 
  shot & -0.65 & 0.44 & 1.00 & -0.68 & 0.74 & 0.27 & -0.42 \\ 
  run200m & 0.77 & -0.49 & -0.68 & 1.00 & -0.82 & -0.33 & 0.62 \\ 
  longjump & -0.91 & 0.78 & 0.74 & -0.82 & 1.00 & 0.07 & -0.70 \\ 
  javelin & -0.01 & 0.00 & 0.27 & -0.33 & 0.07 & 1.00 & 0.02 \\ 
  run800m & 0.78 & -0.59 & -0.42 & 0.62 & -0.70 & 0.02 & 1.00 \\ 
   \hline
\end{tabular}
\end{table}

5) Boxplot

```{r,fig.cap="Boxplots das variáveis.\\label{box2}"}
par(mfrow=c(2,4))
boxplot(hep[,1],cex=1.2,cex.lab=1.2,main="100m Barreiras")
boxplot(hep[,2],cex=1.2,cex.lab=1.2,main="Salto em altura")
boxplot(hep[,3],cex=1.2,cex.lab=1.2,main="Arremesso de peso")
boxplot(hep[,4],cex=1.2,cex.lab=1.2,main="200m rasos")
boxplot(hep[,5],cex=1.2,cex.lab=1.2,main="Salto em distância")
boxplot(hep[,6],cex=1.2,cex.lab=1.2,main="Lançamento dardos")
boxplot(hep[,7],cex=1.2,cex.lab=1.2,main="800m rasos")
#boxplot(hep[,8],cex=1.2,cex.lab=1.2,main="Pontuação total")
```

#histograms

```{r,fig.cap="Histogramas das variáveis.\\label{hist2}"}
par(mfrow=c(2,4))
hist(hep[,1],probability=TRUE,main="100m Barreiras",xlab="",ylab="")
hist(hep[,2],probability=TRUE,main="Salto em altura",xlab="",ylab="")
hist(hep[,3],probability=TRUE,main="Arremesso de peso",xlab="",ylab="")
hist(hep[,4],probability=TRUE,main="200m rasos",xlab="",ylab="")
hist(hep[,5],probability=TRUE,main="Salto em distância",xlab="",ylab="")
hist(hep[,6],probability=TRUE,main="Lançamento dardos",xlab="",ylab="")
hist(hep[,7],probability=TRUE,main="800m rasos",xlab="",ylab="")
#hist(hep[,8],probability=TRUE,main="Pontuação total",xlab="",ylab="")
```

# qqplots

```{r,fig.cap="QQplots das variáveis.\\label{qq2}"}
par(mfrow=c(2,4))
qqPlot(scale(hep[,1]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="100m Barreiras",cex=1.2) %>% invisible()
qqPlot(scale(hep[,2]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Salto em altura",cex=1.2) %>% invisible()
qqPlot(scale(hep[,3]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Arremesso de peso",cex=1.2) %>% invisible()
qqPlot(scale(hep[,4]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="200m rasos",cex=1.2) %>% invisible()
qqPlot(scale(hep[,5]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Salto em distância",cex=1.2) %>% invisible()
qqPlot(scale(hep[,6]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Lançamento dardos",cex=1.2) %>% invisible()
qqPlot(scale(hep[,7]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="800m rasos",cex=1.2) %>% invisible()
#qqPlot(scale(hep[,8]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Pontuação total",cex=1.2)
```

Análise inferencial

```{r,fig.cap="Correlograma das variáveis.\\label{correlo2}"}
corrplot(cor(hep), order = "hclust", tl.col='black', tl.cex=.75) 
```
## ACP


0 - Descritiva
1 - Suposições, dois grupos (variaveis tempo e distancia)
2 - ACP 2 comp 80%
3 - CP1 para o rank devido ao fato de fazer sentido com a direção das variáveis.
4 - Abordar novas classificações bem diferentes (12º->6º)


```{r}
p=7
m.cor<-cor(hep)
aut.val <-  eigen(m.cor)$values
aut.vec <- -(eigen(m.cor)$vectors)
m.aut.val <- t(matrix(((aut.val)),p,p))
result.cp.cor <- princomp(hep,cor=TRUE)

pca_importance <- function(x) {
  vars <- x$sdev^2
  vars <- vars/sum(vars)
  rbind(`PVE (%)` = vars*100, 
        `PVEA (%)` = cumsum(vars)*100)
}

#pca_importance(result.cp.cor)
#pca_importance(result.cp.cor) %>% xtable()

#corr.cp.var <- aut.vec*sqrt(m.aut.val)
#summary(result.cp.cor)$importance

screeplot(result.cp.cor,type=c("lines"),main="autovalores",cex=1.2,cex.lab=1.2,cex.main=1.2)

#result.cp.cor$loadings[1:7,1:2]
#xtable(result.cp.cor$loadings[1:7,1:2] %>% as.data.frame())

cp1 = result.cp.cor$loadings[,1]
```

\begin{table}[ht]
\centering
\caption{Variância Explicada}
\label{var_exp}
\begin{tabular}{rrrrrrrr}
  \hline
 & Comp.1 & Comp.2 & Comp.3 & Comp.4 & Comp.5 & Comp.6 & Comp.7 \\ 
  \hline
PVE (\%) & 63.72 & 17.06 & 7.44 & 6.53 & 3.50 & 1.04 & 0.70 \\ 
  PVEA (\%) & 63.72 & 80.78 & 88.22 & 94.75 & 98.26 & 99.30 & 100.00 \\ 
   \hline
\end{tabular}
\end{table}


\begin{table}[ht]
\centering
\caption{Componentes principais}
\label{comp2}
\begin{tabular}{rrr}
  \hline
 & Comp.1 & Comp.2 \\ 
  \hline
hurdles & 0.45 & 0.16 \\ 
  highjump & -0.38 & -0.25 \\ 
  shot & -0.36 & 0.29 \\ 
  run200m & 0.41 & -0.26 \\ 
  longjump & -0.46 & -0.06 \\ 
  javelin & -0.08 & 0.84 \\ 
  run800m & 0.37 & 0.22 \\ 
   \hline
\end{tabular}
\end{table}


Classificação
Escore da primeira componente principal.
acho q isso ta certo

```{r}
hep = scale(heptathlon[,1:7])
score_comp =result.cp.cor$loadings[1:7,1]
nominhos = row.names(hep)
escore = as.matrix(addmargins(cbind(hep[,1]*score_comp[1],hep[,2]*score_comp[2],hep[,3]*score_comp[3],hep[,4]*score_comp[4],hep[,5]*score_comp[5],hep[,6]*score_comp[6],hep[,7]*score_comp[7])))[1:25,8]
rankreal = c(seq(1,25,1))
hep_score = as.tibble(cbind(hep,rankreal,escore))
h_new_score = hep_score %>% arrange(escore)
ranknovo = c(seq(1,25,1))
h_new_score = cbind(h_new_score,ranknovo)[,8:10] 
h_new_score = h_new_score %>% mutate(escore = -escore)
row.names(h_new_score)<- nominhos
colnames(h_new_score)<-c("Classificação original","Escore","Novo rank")

#xtable(h_new_score[14:25,])

```


\begin{table}[ht]
\centering
\caption{Rankings e escores dos atletas}
\label{rank}
\begin{tabular}{r|r p{1cm} p{1cm}|r|r p{1cm} p{1cm}}
  \hline
 Atleta & Rank & Escore PCA & Novo rank & Atleta & Rank & Escore PCA & Novo rank\\ 
  \hline
Joyner-Kersee (USA) & 1 & 4.12 & 1 & Braun (FRG) & 14 & -0.00 & 14 \\ 
  John (GDR) & 2 & 2.88 & 2 & Ruotsalainen (FIN) & 13 & -0.02 & 15 \\ 
  Behmer (GDR) & 3 & 2.65 & 3 & Yuping (CHN) & 15 & -0.09 & 16 \\ 
  Sablovskaite (URS) & 5 & 1.36 & 4 & Hagger (GB) & 17 & -0.17 & 17 \\ 
  Choubenkova (URS) & 4 & 1.34 & 5 & Brown (USA) & 18 & -0.52 & 18 \\ 
  Schulz (GDR) & 12 & 1.19 & 6 & Mulliner (GB) & 20 & -1.09 & 19 \\ 
  Fleming (AUS) & 7 & 1.10 & 7 & Hautenauve (BEL) & 19 & -1.13 & 20 \\ 
  Greiner (USA) & 6 & 1.04 & 8 & Kytola (FIN) & 21 & -1.45 & 21 \\ 
  Lajbnerova (CZE) & 8 & 0.92 & 9 & Geremias (BRA) & 22 & -2.01 & 22 \\ 
  Bouraga (URS) & 10 & 0.76 & 10 & Hui-Ing (TAI) & 23 & -2.88 & 23 \\ 
  Wijnsma (HOL) & 11 & 0.56 & 11 & Jeong-Mi (KOR) & 24 & -2.97 & 24 \\ 
  Dimitrova (BUL) & 9 & 0.53 & 12 & Launa (PNG) & 25 & -6.27 & 25 \\ 
  Scheider (SWI) & 16 & 0.14 & 13 \\
   \hline
\end{tabular}
\end{table}





#Questão 3

##Introdução

Os dados são relacionados a um estudo sobre a relação entre status socioeconômico dos pais com  a condição de saúde mental de um total de 1760 indivíduos. A variável de status socioeconômico possui 5 níveis, de "A" (alto) até "E" (baixo) e a variável de saúde mental possui 4 níveis sendo, do melhor para o pior, "Boa", "Presença fraca de sintomas", "Presença moderada de sintomas" e "Debilitado".

```{r}
`Saúde mental`<- array(c(121,188,112,186,
                57,105,65,60,
                72,141,77,94,
                36,97,54,78,
                21,71,54,71),
 dim = c(4, 5), dimnames = list(`Saúde mental` = c("Boa","Presença fraca de sintomas","Presença moderada de sintomas","Debilitado"),
 ` Status socioeconômico dos pais` = c("A","B","C","D","E")))
xtable(addmargins(`Saúde mental`))
addmargins(`Saúde mental`)
chisq.test(`Saúde mental`)
```
\begin{table}[ht]
\centering
\begin{tabular}{rrrrrr|r}
  \hline
  \multicolumn{7}{c}{Status Socioeconômico} \\
  \hline
Saúde Mental & A & B & C & D & E & Total \\ 
  \hline
Boa & 121.00 & 57.00 & 72.00 & 36.00 & 21.00 & 307.00 \\ 
  Presença fraca de sintomas & 188.00 & 105.00 & 141.00 & 97.00 & 71.00 & 602.00 \\ 
  Presença moderada de sintomas & 112.00 & 65.00 & 77.00 & 54.00 & 54.00 & 362.00 \\ 
  Debilitado & 186.00 & 60.00 & 94.00 & 78.00 & 71.00 & 489.00 \\ 
  \hline
Total & 607.00 & 287.00 & 384.00 & 265.00 & 217.00 & 1760.00 \\ 
   \hline
\end{tabular}
\end{table}


Proporções estimadas (pelo total de observações) (× 100)

```{r}
margins = addmargins(`Saúde mental`)
margins/1760*100
```

Perfil das linhas

```{r}
n = sum(`Saúde mental`)
linhas = `Saúde mental`
lin = dim(linhas)[1]
for (i in 1:lin){linhas[i,] = linhas[i,]/sum(linhas[i,])*100}
`Total` = c(sum(`Saúde mental`[,1]),sum(`Saúde mental`[,2]),sum(`Saúde mental`[,3]),sum(`Saúde mental`[,4]),sum(`Saúde mental`[,5]))/n*100
#xtable(addmargins(rbind(linhas,`Total`))[1:5,1:6])
addmargins(rbind(linhas,`Total`))[1:5,1:6]
```

Perfil das Colunas

```{r}
n = sum(`Saúde mental`)
colunas = `Saúde mental`
col = dim(linhas)[2]
for (i in 1:col){colunas[,i] = colunas[,i]/sum(colunas[,i])*100}
`Total` = c(sum(`Saúde mental`[1,]),sum(`Saúde mental`[2,]),sum(`Saúde mental`[3,]),sum(`Saúde mental`[4,]))/n*100
#xtable(addmargins(rbind(colunas,`Total`))[1:5,1:6])
addmargins(cbind(colunas,`Total`))[1:5,1:6]
```

Análise de corresponcência

```{r}
resultCA <- ca(`Saúde mental`) # names(resultCA)
inercia<-summary(resultCA)$scree # names(summary(resultCA))
#xtable(cbind(sqrt(inercia[,2]), inercia[,2],inercia[,3],inercia[,4]),digits=4)
```

```{r}

# Componentes
resultFCA <- plot(resultCA,xlab="componente 1",ylab="componente 2",
                  cex=1.4,cex.lab=1.2) #Biplot
#
#xtable(resultFCA$rows,digits=4)
#xtable(resultFCA$cols,digits=4)

```

Classe A está mais relacionada com saúde mental debilitada que as demais.
Classes B e C estão mais relacionadas com presença fraca
Classe D está mais relacionada à presença moderada
Classe E está mais longe da saúde mental BOA











# Questão 4
Lista 7 questão 11
Análise discriminate


```{r}
data("PimaIndiansDiabetes2")
indi = PimaIndiansDiabetes2 %>% na.omit()
indiP = indi %>% filter(diabetes == "pos") %>% dplyr::select(-c(diabetes,pedigree))
indiN = indi %>% filter(diabetes == "neg") %>% dplyr::select(-c(diabetes,pedigree))
```

## Análise descritiva

1) Medidas Resumo

Positivo

```{r}
SumIP<- cbind(round(apply(indiP,2,mean),4),round(apply(indiP,2,var),4),
                round(apply(indiP,2,sd),4),
                round(100*apply(indiP,2,sd)/apply(indiP,2,mean),4),
                round(apply(indiP,2,min),4),round(apply(indiP,2,quantile,0.5),4),
                round(apply(indiP,2,max),4),
                round(apply(indiP,2,skewness),4),
                round(apply(indiP,2,kurtosis),4))
colnames(SumIP)<-c("Média","Var.","DP","CV(%)","Min.","Med.","Max.",
                     "CA","Cur.")
#xtable(SumIP)
#SumIP
```

\begin{table}[ht]
\centering
\caption{Medidas resumo das variáveis dos pacientes com diabetes positivo}
\label{med_pos}
\begin{tabular}{rrrrrrrrrr}
  \hline
 & Média & Var. & DP & CV(\%) & Min. & Med. & Max. & CA & Cur. \\ 
  \hline
pregnant & 4.47 & 15.34 & 3.92 & 87.62 & 0.00 & 3.00 & 17.00 & 0.81 & 2.91 \\ 
  glucose & 145.19 & 890.39 & 29.84 & 20.55 & 78.00 & 144.50 & 198.00 & -0.14 & 2.08 \\ 
  pressure & 74.08 & 169.56 & 13.02 & 17.58 & 30.00 & 74.00 & 110.00 & -0.13 & 3.96 \\ 
  triceps & 32.96 & 92.98 & 9.64 & 29.25 & 7.00 & 33.00 & 63.00 & 0.10 & 3.01 \\ 
  insulin & 206.85 & 17609.26 & 132.70 & 64.15 & 14.00 & 169.50 & 846.00 & 1.86 & 7.31 \\ 
  mass & 35.78 & 45.36 & 6.73 & 18.82 & 22.90 & 34.60 & 67.10 & 1.36 & 6.78 \\ 
  age & 35.94 & 113.10 & 10.63 & 29.59 & 21.00 & 33.00 & 60.00 & 0.57 & 2.20 \\ 
   \hline
\end{tabular}
\end{table}

```{r}
SumIN<- cbind(round(apply(indiN,2,mean),4),round(apply(indiN,2,var),4),
                round(apply(indiN,2,sd),4),
                round(100*apply(indiN,2,sd)/apply(indiN,2,mean),4),
                round(apply(indiN,2,min),4),round(apply(indiN,2,quantile,0.5),4),
                round(apply(indiN,2,max),4),
                round(apply(indiN,2,skewness),4),
                round(apply(indiN,2,kurtosis),4))
colnames(SumIN)<-c("Média","Var.","DP","CV(%)","Min.","Med.","Max.",
                     "CA","Cur.")
#xtable(SumIN)
#SumIN
```

\begin{table}[ht]
\centering
\caption{Medidas resumo das variáveis dos pacientes com diabetes negativo}
\label{med_neg}
\begin{tabular}{rrrrrrrrrr}
  \hline
 & Média & Var. & DP & CV(\%) & Min. & Med. & Max. & CA & Cur. \\ 
  \hline
pregnant & 2.72 & 6.85 & 2.62 & 96.20 & 0.00 & 2.00 & 13.00 & 1.49 & 5.23 \\ 
  glucose & 111.43 & 607.23 & 24.64 & 22.11 & 56.00 & 107.50 & 197.00 & 0.72 & 3.51 \\ 
  pressure & 68.97 & 141.44 & 11.89 & 17.24 & 24.00 & 70.00 & 106.00 & -0.16 & 3.68 \\ 
  triceps & 27.25 & 108.87 & 10.43 & 38.29 & 7.00 & 27.00 & 60.00 & 0.35 & 2.49 \\ 
  insulin & 130.85 & 10532.13 & 102.63 & 78.43 & 15.00 & 105.00 & 744.00 & 2.50 & 11.81 \\ 
  mass & 31.75 & 46.17 & 6.79 & 21.40 & 18.20 & 31.25 & 57.30 & 0.43 & 3.13 \\ 
  age & 28.35 & 80.80 & 8.99 & 31.71 & 21.00 & 25.00 & 81.00 & 2.20 & 9.13 \\ 
   \hline
\end{tabular}
\end{table}


2)Diagrama de dispersão

Positivo

```{r,fig.cap="Matriz de gráfico de dispersões dos pacientes com diabetes positivo.\\label{disp_pos}"}
plot(indiP,cex=1.5,cex.lab=1.5,pch=1)
```

Negativo

```{r,fig.cap="Matriz de gráfico de dispersões dos pacientes com diabetes negativo.\\label{disp_neg}"}
plot(indiN,cex=1.5,cex.lab=1.5,pch=1)
```

3) Matriz de covariâncias

Positivo

```{r}
#xtable(cov(indiP))
#cov(indiP)
```
\begin{table}[ht]
\centering
\caption{Matriz de covariâncias dos pacientes com diabetes positivo}
\label{cov_pos}
\begin{tabular}{rrrrrrrr}
  \hline
 & pregnant & glucose & pressure & triceps & insulin & mass & age \\ 
  \hline
pregnant & 15.34 & 2.17 & 9.00 & -2.67 & -1.73 & -4.90 & 25.19 \\ 
  glucose & 2.17 & 890.39 & 35.98 & 10.82 & 1576.11 & -5.35 & 60.11 \\ 
  pressure & 9.00 & 35.98 & 169.56 & 19.72 & -126.61 & 17.02 & 37.49 \\ 
  triceps & -2.67 & 10.82 & 19.72 & 92.98 & 66.34 & 38.44 & -12.60 \\ 
  insulin & -1.73 & 1576.11 & -126.61 & 66.34 & 17609.26 & -17.50 & 310.66 \\ 
  mass & -4.90 & -5.35 & 17.02 & 38.44 & -17.50 & 45.36 & -12.63 \\ 
  age & 25.19 & 60.11 & 37.49 & -12.60 & 310.66 & -12.63 & 113.10 \\ 
   \hline
\end{tabular}
\end{table}


Negativo

```{r}
#xtable(cov(indiN))
#cov(indiN)
```
\begin{table}[ht]
\centering
\caption{Matriz de covariâncias dos pacientes com diabetes negativo}
\label{cov_neg}
\begin{tabular}{rrrrrrrr}
  \hline
 & pregnant & glucose & pressure & triceps & insulin & mass & age \\ 
  \hline
pregnant & 6.85 & 8.72 & 5.41 & 2.71 & 1.80 & -0.78 & 16.48 \\ 
  glucose & 8.72 & 607.23 & 46.15 & 27.16 & 1560.34 & 25.46 & 47.03 \\ 
  pressure & 5.41 & 46.15 & 141.44 & 26.33 & 152.53 & 24.79 & 25.86 \\ 
  triceps & 2.71 & 27.16 & 26.33 & 108.87 & 163.90 & 46.90 & 18.76 \\ 
  insulin & 1.80 & 1560.34 & 152.53 & 163.90 & 10532.13 & 190.04 & 48.66 \\ 
  mass & -0.78 & 25.46 & 24.79 & 46.90 & 190.04 & 46.17 & 3.56 \\ 
  age & 16.48 & 47.03 & 25.86 & 18.76 & 48.66 & 3.56 & 80.80 \\ 
   \hline
\end{tabular}
\end{table}


4) Matriz de correlações

Positivo

```{r}
#xtable(cor(indiP))
#cor(indiP)
```
\begin{table}[ht]
\centering
\caption{Matriz de correlações dos pacientes com diabetes positivo}
\label{corr_pos}
\begin{tabular}{rrrrrrrr}
  \hline
 & pregnant & glucose & pressure & triceps & insulin & mass & age \\ 
  \hline
pregnant & 1.00 & 0.02 & 0.18 & -0.07 & -0.00 & -0.19 & 0.60 \\ 
  glucose & 0.02 & 1.00 & 0.09 & 0.04 & 0.40 & -0.03 & 0.19 \\ 
  pressure & 0.18 & 0.09 & 1.00 & 0.16 & -0.07 & 0.19 & 0.27 \\ 
  triceps & -0.07 & 0.04 & 0.16 & 1.00 & 0.05 & 0.59 & -0.12 \\ 
  insulin & -0.00 & 0.40 & -0.07 & 0.05 & 1.00 & -0.02 & 0.22 \\ 
  mass & -0.19 & -0.03 & 0.19 & 0.59 & -0.02 & 1.00 & -0.18 \\ 
  age & 0.60 & 0.19 & 0.27 & -0.12 & 0.22 & -0.18 & 1.00 \\ 
   \hline
\end{tabular}
\end{table}



Negativo

```{r}
#xtable(cor(indiN))
#cor(indiN)
```
\begin{table}[ht]
\centering
\caption{Matriz de correlações dos pacientes com diabetes negativo}
\label{corr_neg}
\begin{tabular}{rrrrrrrr}
  \hline
 & pregnant & glucose & pressure & triceps & insulin & mass & age \\ 
  \hline
pregnant & 1.00 & 0.14 & 0.17 & 0.10 & 0.01 & -0.04 & 0.70 \\ 
  glucose & 0.14 & 1.00 & 0.16 & 0.11 & 0.62 & 0.15 & 0.21 \\ 
  pressure & 0.17 & 0.16 & 1.00 & 0.21 & 0.12 & 0.31 & 0.24 \\ 
  triceps & 0.10 & 0.11 & 0.21 & 1.00 & 0.15 & 0.66 & 0.20 \\ 
  insulin & 0.01 & 0.62 & 0.12 & 0.15 & 1.00 & 0.27 & 0.05 \\ 
  mass & -0.04 & 0.15 & 0.31 & 0.66 & 0.27 & 1.00 & 0.06 \\ 
  age & 0.70 & 0.21 & 0.24 & 0.20 & 0.05 & 0.06 & 1.00 \\ 
   \hline
\end{tabular}
\end{table}



Boxplot

```{r,fig.cap="Boxplots das variáveis dos pacientes com diabetes positivo.\\label{box_pos}"}
par(mfrow=c(2,4))
boxplot(indiP[,1],cex=1.2,cex.lab=1.2,main="Gravidez (P)")
boxplot(indiP[,2],cex=1.2,cex.lab=1.2,main="Glicose (P)")
boxplot(indiP[,3],cex=1.2,cex.lab=1.2,main="Pressão (P)")
boxplot(indiP[,4],cex=1.2,cex.lab=1.2,main="Tríceps (P)")
boxplot(indiP[,5],cex=1.2,cex.lab=1.2,main="Insulina (P)")
boxplot(indiP[,6],cex=1.2,cex.lab=1.2,main="IMC (P)")
boxplot(indiP[,7],cex=1.2,cex.lab=1.2,main="idade (P)")
```

```{r,fig.cap="Boxplots das variáveis dos pacientes com diabetes negativo.\\label{box_neg}"}
par(mfrow = c(2,4))
boxplot(indiN[,1],cex=1.2,cex.lab=1.2,main="Gravidez (N)")
boxplot(indiN[,2],cex=1.2,cex.lab=1.2,main="Glicose (N)")
boxplot(indiN[,3],cex=1.2,cex.lab=1.2,main="Pressão (N)")
boxplot(indiN[,4],cex=1.2,cex.lab=1.2,main="Tríceps (N)")
boxplot(indiN[,5],cex=1.2,cex.lab=1.2,main="Insulina (N)")
boxplot(indiN[,6],cex=1.2,cex.lab=1.2,main="IMC (N)")
boxplot(indiN[,7],cex=1.2,cex.lab=1.2,main="Idade (N)")
```

histograms

```{r,fig.cap="Histogramas das variáveis dos pacientes com diabetes positivo.\\label{hist_pos}"}
par(mfrow=c(2,4))
hist(indiP[,1],probability=TRUE,main="Gravidez (P)",xlab="",ylab="")
hist(indiP[,2],probability=TRUE,main="Glicose (P)",xlab="",ylab="")
hist(indiP[,3],probability=TRUE,main="Pressão (P)",xlab="",ylab="")
hist(indiP[,4],probability=TRUE,main="Tríceps (P)",xlab="",ylab="")
hist(indiP[,5],probability=TRUE,main="Insulina (P)",xlab="",ylab="")
hist(indiP[,6],probability=TRUE,main="IMC (P)",xlab="",ylab="")
hist(indiP[,7],probability=TRUE,main="Idade (P)",xlab="",ylab="")
```

```{r,fig.cap="Histogramas das variáveis dos pacientes com diabetes negativo.\\label{hist_neg}"}
par(mfrow=c(2,4))
hist(indiN[,1],probability=TRUE,main="Gravidez (N)",xlab="",ylab="")
hist(indiN[,2],probability=TRUE,main="Glicose (N)",xlab="",ylab="")
hist(indiN[,3],probability=TRUE,main="Pressão (N)",xlab="",ylab="")
hist(indiN[,4],probability=TRUE,main="Tríceps (N)",xlab="",ylab="")
hist(indiN[,5],probability=TRUE,main="Insulina (N)",xlab="",ylab="")
hist(indiN[,6],probability=TRUE,main="IMC (N)",xlab="",ylab="")
hist(indiN[,7],probability=TRUE,main="Idade (N)",xlab="",ylab="")
```

 qqplots

```{r,fig.cap="QQplots das variáveis dos pacientes com diabetes positivo.\\label{qq_pos}"}
par(mfrow=c(2,4))
qqPlot(scale(indiP[,1]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Gravidez (P)",cex=1.2)
qqPlot(scale(indiP[,2]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Glicose (P)",cex=1.2)
qqPlot(scale(indiP[,3]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Pressão (P)",cex=1.2)
qqPlot(scale(indiP[,4]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Tríceps (P)",cex=1.2)
qqPlot(scale(indiP[,5]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Insulina (P)",cex=1.2)
qqPlot(scale(indiP[,6]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="IMC (P)",cex=1.2)
qqPlot(scale(indiP[,7]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Idade (P)",cex=1.2)
```


```{r,fig.cap="QQplots das variáveis dos pacientes com diabetes positivo.\\label{qq_neg}"}
par(mfrow=c(2,4))
qqPlot(scale(indiP[,1]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Gravidez (N)",cex=1.2)
qqPlot(scale(indiP[,2]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Glicose (N)",cex=1.2)
qqPlot(scale(indiP[,3]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Pressão (P)",cex=1.2)
qqPlot(scale(indiP[,4]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Tríceps (N)",cex=1.2)
qqPlot(scale(indiP[,5]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Insulina (N)",cex=1.2)
qqPlot(scale(indiP[,6]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="IMC (N)",cex=1.2)
qqPlot(scale(indiP[,7]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Idade (N)",cex=1.2)
```

# Classificação:

```{r}
set.seed(198105)
indid = indi %>% dplyr::select(-pedigree) %>% arrange(diabetes)
#treinoP <- sort(sample(1:130,104,replace=FALSE)) #80% das observações para treino
#treinoN <- sort(sample(131:392,210,replace=FALSE)) #80% das observações para treino
treinoP <- sort(sample(1:130,65,replace=FALSE)) #50% das observações para treino
treinoN <- sort(sample(131:392,131,replace=FALSE)) #50% das observações para treino
treino <- c(treinoP,treinoN)
```

Amostra de treino

```{r}
atrein <- indid[treino,]
```

Matriz de correlações muito parecidas. Método de Fisher

```{r}
m.X <- rbind(indid[1:130,1:7],indid[131:392,1:7])
Sp = c(rep("N",130),rep("P",262))
m.Indi <- data.frame(m.X,Sp)
table(m.Indi$Sp[treino])
#result.ad <- lda(Sp~., m.Iris, prior = c(1,1)/2,subset = treino)
result.ad <- lda(Sp~., m.Indi[,1:7], prior = c(1,1)/2,subset = treino)
result.ad
```

# predizendo os grupos na amostra teste

```{r}
pred<-predict(result.ad, m.Indi[-treino, ])$class
```

#Função discriminante

```{r}
y <-predict(result.ad, m.Indi[-treino, ])$x 
```


# Pegando a amostra teste

```{r}
data.teste <- m.Indi[-treino,8]
```


# Tabela de classificação

```{r}
tc <- table(data.teste,pred)
tc
#xtable(tc)
```
TEA

```{r}
TEA <- (tc[1,2]+tc[2,1])/sum(tc)
100*TEA
```

Método de normalidade

```{r}
m.dados.iris <- m.Indi[treino,]
#  Dados.1 <- m.dados.iris[m.dados.iris[,5]=="VE",][,]
#  Dados.2 <- m.dados.iris[m.dados.iris[,5]=="VI",][,]
Dados.1 <- (m.dados.iris[m.dados.iris[,8]=="N",][,1:7])
Dados.2 <- (m.dados.iris[m.dados.iris[,8]=="P",][,1:7])
v.mean1 <- cbind(c(result.ad$means[1,]))
v.mean2 <- cbind(c(result.ad$means[2,]))
S21 <- cov(Dados.1[,1:7])
S22 <- cov(Dados.2[,1:7])
Sp <- ((nrow(Dados.1)-1)*S21 +  ((nrow(Dados.2)-1)*S22))/(nrow(Dados.1) + nrow(Dados.2) - 2)
q.classifi <- 0.5*t(v.mean1-v.mean2)%*%solve(Sp)%*%(v.mean1+v.mean2)
delta2 <-  t(v.mean1-v.mean2)%*%solve(Sp)%*%(v.mean1 - v.mean2)
#
TOE <- pnorm(-sqrt(delta2)/2)
100*TOE
xtable(cbind(v.mean1,v.mean2))
xtable(S21)
xtable(S22)
```


```{r}
m = 0.5*(t(v.mean1-v.mean2))%*%solve(Sp)%*%((v.mean1-v.mean2))
  
# Função linear discriminante
  
Y <- t(v.mean1-v.mean2)%*%solve(Sp)%*%t(as.matrix(m.Indi[-treino,1:7]))
m = 0.5*(t(v.mean1-v.mean2))%*%solve(Sp)%*%((v.mean1+v.mean2))
  
# Comparação entre os coeficientes Coeficientes
cbind(t(t(v.mean1-v.mean2)%*%solve(Sp)),result.ad$scaling)
(t(t(v.mean1-v.mean2)%*%solve(Sp)))/result.ad$scaling

# Análise da função discriminante para a amostra teste
grupo <- as.factor(c(rep("N",131), rep("P",65)))
# Medidas resumo
datadados<-data.frame(y,grupo)
colnames(datadados)<-c("y","dados")
medados<-ddply(datadados,.(grupo),summarise,media=mean(y),dp=sqrt(var(y)),vari=var(y),minimo=min(y),mediana=quantile(y,0.5),maximo=max(y),n=length(y))
colnames(medados)<-c("Grupo","Média","DP","Var.","Mínimo","Mediana","Máximo","n")
xtable(medados)
```

```{r}
# boxplot
par(mfrow=c(1,1))
boxplot(y~grupo,cex=1.2,cex.lab=1.2)
#
# densidades
plot(density(y[grupo=="P",1]),lwd=2,xlim=c(min(y[,1])-1,max(y[,1])+3),xlab="função discriminante",ylab="densidade",cex=1.2,cex.lab=1.2,cex.main=1.2,main="",ylim=c(0,0.9))
lines(density(y[grupo=="N",1]),col=2,lwd=2)
legend(3.8,0.6,lwd=c(2,2),col=c(1,2),legend=c("Positivo","Negativo"),bty="n",cex=1.2)

#hist(y[grupo=="P"],probability=TRUE,cex=1.2,cex.lab=1.2)
#hist(y[grupo=="N"],probability=TRUE,cex=1.2,cex.lab=1.2)
```




