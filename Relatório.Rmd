---
output:
  pdf_document:
    number_sections: yes
    latex_engine: xelatex
fig_caption: yes
margin: auto
fontsize: 11pt
header-includes:
- \usepackage{float}
- \floatplacement{figure}{H}
- \usepackage[brazil, english, portuguese]{babel}
- \usepackage{abstract}
- \usepackage{hyperref}
- \usepackage[style=abnt]{biblatex}
- \addbibresource{ref.bib}
- \usepackage{fontspec}
- \usepackage{geometry}
   \geometry{
   a4paper,
   total={180mm,240mm},
   left=15mm,
   top=20mm,
   }
- \setmainfont{Arial}
link-citations: yes
---


```{r message=FALSE, warning=FALSE, echo=F}
library(knitr)
library(kableExtra)
opts_chunk$set(echo=F)
opts_chunk$set(warning = F)
opts_chunk$set(message= FALSE)
opts_chunk$set(eval=T)
opts_chunk$set(include=T)
opts_chunk$set(fig.align="center")
opts_chunk$set(fig.height = 2.5)
library(plyr)
library(readr)
library(ggplot2)
library(tidyverse)
library(MASS)
library(car)
library(xtable)
library(moments)
library(MVA)
library(mlbench)
library(plotrix)
library(corrplot)
library(ggcorrplot)
library(psych)
library(ca)

```

\renewcommand{\figurename}{Figura}
\renewcommand{\tablename}{Tabela}
\renewcommand{\baselinestretch}{1.5}

\begin{titlepage}
\begin{center} 

{\LARGE UNICAMP - Universidade Estadual de Campinas}\\[0.2cm] 
{\Large IMECC - Instituto de Matemática, Estatística e Computação Científica}\\[0.2cm] 
{\Large Departamento de Estatística}\\[0.2cm]
{\Large ME731 - Métodos em Análise Multivariada}\\[6.1cm]
{\bf \Large Trabalho}\\[5.5cm] 

\begin{flushright}
{ Carlos Caminho Oco RA 168624 \\ 
marfloy Chaves eduardo RA 173733\\
Caio Henrique de Sousa Lima RA 214144\\ 
Piupiu Mendes Pazelli RA 219494\\
Nathan Blusa Amaarela Soltinho RA 222854} \\[5cm] 
\end{flushright}


{Campinas}\\
{2020}
\end{center}
\end{titlepage}

# Questão 1
hist apenas no relatorio, qq e boxplot apendice

## Introdução

O banco de dados é composto pelo perfil de tamanho e formato de 48 tartarugas, sendo 24 machos e 24 fêmeas.As informações obtidas foram largura, comprimento e altura. O estudo tinha como objetivo observar e comparar o sexo ao qual o animal pertencia e sua relação com essas medidas físicas. Para realizar a análise desse banco, foi utilizado o software estatístico R e aplicado algumas metodologias como a Análise de Variância Multivariada (MANOVA).

```{r}
turtle = read_table2("q1.txt") %>% arrange(sex)

turtle$length = as.numeric(turtle$length)
turtle$width = as.numeric(turtle$width)
turtle$height = as.numeric(turtle$height)
turtleF = turtle %>% filter(sex == "F") %>% dplyr::select(-sex)
turtleM = turtle %>% filter(sex == "M") %>% dplyr::select(-sex)
```

## Análise descritiva 


```{r}
SumF<- cbind(round(apply(turtleF,2,mean),4),round(apply(turtleF,2,var),4),
                round(apply(turtleF,2,sd),4),
                round(100*apply(turtleF,2,sd)/apply(turtleF,2,mean),4),
                round(apply(turtleF,2,min),4),round(apply(turtleF,2,quantile,0.5),4),
                round(apply(turtleF,2,max),4),
                round(apply(turtleF,2,skewness),4),
                round(apply(turtleF,2,kurtosis),4))
colnames(SumF)<-c("Média","Var.","DP","CV(%)","Min.","Med.","Max.",
                     "CA","Cur.")
```


```{r}
SumM<- cbind(round(apply(turtleM,2,mean),4),round(apply(turtleM,2,var),4),
                round(apply(turtleM,2,sd),4),
                round(100*apply(turtleM,2,sd)/apply(turtleM,2,mean),4),
                round(apply(turtleM,2,min),4),round(apply(turtleM,2,quantile,0.5),4),
                round(apply(turtleM,2,max),4),
                round(apply(turtleM,2,skewness),4),
                round(apply(turtleM,2,kurtosis),4))
colnames(SumM)<-c("Média","Var.","DP","CV(%)","Min.","Med.","Max.",
                     "CA","Cur.")
#xtable(rbind(SumF,SumM))
```
\begin{table}[ht]
\centering
\caption{Medidas resumo (F = Fem, M = Masc)}
\label{desc}
\begin{tabular}{rrrrrrrrrr}
  \hline
 & Média & Var. & DP & CV(\%) & Min. & Med. & Max. & CA & Cur. \\ 
  \hline
length (F) & 136.00 & 451.39 & 21.25 & 15.62 & 98.00 & 136.50 & 177.00 & -0.23 & 2.26 \\ 
  width (F)& 102.58 & 171.73 & 13.10 & 12.77 & 81.00 & 102.00 & 132.00 & 0.31 & 2.55 \\ 
  height (F) & 51.96 & 66.65 & 8.16 & 15.71 & 38.00 & 51.00 & 67.00 & -0.03 & 2.19 \\ 
  length (M) & 113.38 & 138.77 & 11.78 & 10.39 & 93.00 & 115.00 & 135.00 & -0.08 & 2.10 \\ 
  width (M) & 88.29 & 50.04 & 7.07 & 8.01 & 74.00 & 89.00 & 106.00 & 0.20 & 3.15 \\ 
  height (M) & 40.71 & 11.26 & 3.36 & 8.24 & 35.00 & 40.00 & 47.00 & 0.18 & 2.20 \\ 
   \hline
\end{tabular}
\end{table}




Inicialmente, visualizando as medidas resumo para cada sexo, podemos observar que aparentemente o sexo feminino tem, em média, medidas maiores que o sexo masculino.


```{r,fig.cap="Matriz de gráfico de dispersões sexo feminino.\\label{dispF}"}
plot(turtleF,cex=1.5,cex.lab=1.5,pch=1)
```


```{r,fig.cap="Matriz de gráfico de dispersões sexo masculino.\\label{dispM}"}
plot(turtleM,cex=1.5,cex.lab=1.5,pch=1)
```

Para ambos os sexos, as medidas de altura, largura e comprimento são bastante correlacionadas.


```{r}
#xtable(cov(turtleF))
```

\begin{table}[ht]
\centering
\caption{Matriz de covariâncias (F = Fem, M = Masc)}
\label{covF}
\begin{tabular}{r|rrr|rrr}
  \hline
 & length (F) & width (F) & height (F) & length (M) & width (M) & height (M) \\ 
  \hline
  length & 451.39 & 271.17 & 168.70 & 138.77 & 79.15 & 37.38\\ 
  width & 271.17 & 171.73 & 103.29 & 79.15 & 50.04 & 21.65\\ 
  height & 168.70 & 103.29 & 66.65 & 37.38 & 21.65 & 11.26\\ 
   \hline
\end{tabular}
\end{table}


```{r}
#xtable(cov(turtleM))
```


A matriz de covariância para ambos os sexos parecem ser diferentes, na qual as medidas do sexo masculino aparentam ter variância bem menor se comparado ao sexo feminino.


##########
4) Matriz de correlações

Feminino

```{r}
#xtable(cor(turtleF))
cor(turtleF)
```

Masculino

```{r}
#xtable(cor(turtleM))
cor(turtleM)
```

Como dito anteriormente, as correlações parecem ser bem altas entre as medidas (já era esperado).
##########


```{r,fig.cap="Boxplots das variáveis por sexo.\\label{boxTurtle}"}
par(mfrow=c(2,3))
boxplot(turtleF[,1],cex=1.2,cex.lab=1.2,main="Length (F)")
boxplot(turtleF[,2],cex=1.2,cex.lab=1.2,main="Width (F)")
boxplot(turtleF[,3],cex=1.2,cex.lab=1.2,main="Heigth (F)")
boxplot(turtleM[,1],cex=1.2,cex.lab=1.2,main="Length (M)")
boxplot(turtleM[,2],cex=1.2,cex.lab=1.2,main="Width (M)")
boxplot(turtleM[,3],cex=1.2,cex.lab=1.2,main="Heigth (M)")
```


```{r,fig.cap="Histogramas das variáveis por sexo.\\label{histTurtle}"}
par(mfrow=c(2,3))
hist(turtleF$length,probability=TRUE,main="Length (F)",xlab="",ylab="")
hist(turtleF$width,probability=TRUE,main="Width (F)",xlab="",ylab="")
hist(turtleF$height,probability=TRUE,main="Heigth (F)",xlab="",ylab="")
hist(turtleM$length,probability=TRUE,main="Length (M)",xlab="",ylab="")
hist(turtleM$width,probability=TRUE,main="Width (M)",xlab="",ylab="")
hist(turtleM$height,probability=TRUE,main="Heigth (M)",xlab="",ylab="")
```


```{r,fig.cap="QQplots das variáveis por sexo.\\label{qqTurtle}"}
par(mfrow=c(2,3))
qqPlot(scale(turtleF$length),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Length (F)",cex=1.2) %>% invisible()
qqPlot(scale(turtleF$width),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Width (F)",cex=1.2)%>% invisible()
qqPlot(scale(turtleF$height),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Heigth (F)",cex=1.2)%>% invisible()
qqPlot(scale(turtleM$length),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Length (M)",cex=1.2)%>% invisible()
qqPlot(scale(turtleM$width),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Width (M)",cex=1.2)%>% invisible()
qqPlot(scale(turtleM$height),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Heigth (M)",cex=1.2)%>% invisible()
```

Olhando para boxplot,histogramas e qqplots, as variáveis não parecem seguir uma distribuição normal.

## Análise inferencial


```{r}
Box.teste.Igual.MCov<-function(m.X.completa,v.grupos,v.n,G)
{
  # v.grupos (1,2,3...)
  # m.X.completa : matriz de dados com todos os grupos
  grupo <- 1
  p<- ncol(m.X.completa)
  m.X.k <- m.X.completa[v.grupos==grupo,]
  Sigma.k <- cov(m.X.k)
  m.Sigma.completa <- cbind(grupo,Sigma.k)
  Sigma.P <- (v.n[grupo]-1)*Sigma.k # estimativa ponderada
  aux.k.1 <- (v.n[grupo] - 1)*log(det(Sigma.k))
  grupo <- grupo + 1
  for (i in 2:G)
  {
    m.X.k <- m.X.completa[v.grupos==grupo,] # pegar os dados referentes ao grupo i
    Sigma.k <- cov(m.X.k)
    m.Sigma.completa <- rbind(m.Sigma.completa,cbind(grupo,Sigma.k))
    Sigma.P <- Sigma.P + (v.n[grupo]-1)*Sigma.k # estimativa ponderada
    aux.k.1 <- aux.k.1 + (v.n[grupo] - 1)*log(det(Sigma.k))
    grupo <- grupo + 1
  }
  Sigma.P <- Sigma.P/(sum(v.n)-G)
  
  # Estatística de ajuste
  aux.u <- (sum(1/(v.n - 1)) - (1/(sum(v.n - 1))))*(2*p^2 + 3*p - 1)/(6*(p+1)*(G-1))
  Q.B <-  (1 - aux.u)*(sum(v.n-1)*log(det(Sigma.P)) - aux.k.1)
  aux.v <- 0.5*p*(p+1)*(G-1)
  e.nd.QB <- 1 - pchisq(Q.B,aux.v)
  cat("Estatística do Teste: ", Q.B, "\n")
  cat("nível descritivo: ",e.nd.QB,"\n")
  cat("Matrizes de Covariâncias por grupo: \n")
  print(m.Sigma.completa)
  Sigma.P <-as.matrix(data.frame(Sigma.P))
  list(Sigma.P=Sigma.P)
} # fim da função

# mY: matriz de dados
# fit.model: ajuste da função lm

mSigmareg <- function(mY,fit.model)
{
  mX <- as.matrix(model.matrix(fit.model))
  q <- ncol(mX)
  p<-ncol(mY)
  n <- nrow(mY)
  mB <- matrix(coef(fit.model),q,p)
  mSigma <- t(as.matrix(mY-mX%*%mB))%*%(as.matrix(mY-mX%*%mB))/(n-q)
  return(mSigma)
}

# mY: matriz de dados
# fit.model: ajuste da função lm
# gama: nível de confiança

estim.par.MRNLM <- function(mY,fit.model,gama)

{

vbeta <- c(t(coef(fit.model)))
mSigma<-mSigmareg(mY,fit.model)
mX <-as.matrix(model.matrix(fit.model))
n<-nrow(mX)
q<-ncol(mX)
mSigmabeta <- kronecker(solve(t(mX)%*%mX),mSigma)
epbeta<-sqrt(diag(mSigmabeta))
et <- qt(0.5*(1+gama),df=n-q)
LIIC <- vbeta-et*epbeta
LSIC <- vbeta+et*epbeta
estt <- vbeta/epbeta
pvalor <- 2*(1-pt(abs(estt),df=n-q))
#
mresult <- cbind(vbeta,epbeta,LIIC,LSIC,estt,pvalor)
return(mresult)

  
}

# fit.model: ajuste da função manova
# m.Sigma.P: matriz de variâncias e covariâncias estimada via modelo
# p: número de variáveis
# q: número de parâmetros por variável
# m.C,m.U,m.M: matrizes de interesse

Teste.CBU.M<-function(fit.model,m.Sigma.P,p,q,m.C,m.U,m.M)
{
  m.B <- matrix(coef(fit.model),q,p)
  v.beta <- matrix(t(m.B))
  m.X <- model.matrix(fit.model)
  m.Ca <- kronecker(m.C,t(m.U))
  m.Ma <- matrix(t(m.M))
  v.theta <- m.Ca%*%v.beta - m.Ma
  m.Sigmabeta <- kronecker(solve(t(m.X)%*%m.X),m.Sigma.P)
  estat <- t(v.theta)%*%solve(m.Ca%*%(m.Sigmabeta)%*%t(m.Ca))%*%v.theta
  p.valor <- 1-pchisq(estat,df=nrow(m.C)*ncol(m.U))
  cat("Estatistica Qui-quadrado = ",round(estat,2),"\n")
  cat("pvalor = ",round(p.valor,4),"\n")
  cat("Matriz C :","\n")
  print(m.C)
  cat("Matriz U :","\n")
  print(m.U)
  cat("Matriz M :","\n")
  print(m.M)
}
```

```{r}
sex = turtle$sex
turtled = turtle %>% dplyr::select(-sex)
v.grupos = as.vector(cbind(as.numeric(factor(sex))))
v.n = c(24,24)
G = 2
```



```{r,warning = FALSE}
#m.Sigma.P<-Box.teste.Igual.MCov(turtled,v.grupos,v.n,G)$Sigma.P
#xtable(m.Sigma.P)
fit.model<-m.ajuste <- manova(as.matrix(turtled) ~ sex)
#summary.manova(m.ajuste,test="Wilks")
#summary.manova(m.ajuste,test="Pillai")
#summary.manova(m.ajuste,test="Hotelling-Lawley")
#summary.manova(m.ajuste,test="Roy")
```

\begin{table}[ht]
\centering
\caption{Teste de Box-Cox para homocedasticidade}
\label{Boxhom}
\begin{tabular}{rrr}

  \hline
 & Estatística do teste & p-valor  \\ 
  \hline
 Box-Cox & 24.04 & 0.0005 \\ 
   \hline
\end{tabular}
\end{table}

\begin{table}[ht]
\centering
\caption{Resultados da MANOVA}
\label{MANOVA1}
\begin{tabular}{rrrr}

  \hline
 & Valor & Aproximação pela distribuição F & p-valor \\ 
  \hline
Wilks & 0.41 & 21.28 & $<$ 0.0001 \\ 
Pillai & 0.59 & 21.28 & $<$ 0.0001 \\ 
Hotelling-Lawley & 1.45 & 21.28  & $<$ 0.0001 \\ 
Roy & 1.45 & 21.28 & $<$ 0.0001  \\ 
   \hline
\end{tabular}
\end{table}

Para observar inferencialmente a diferença entre as matrizes de covariância de cada grupo, foi realizado um teste de Box-cox, e tivemos como resultado que as matrizes realmente são diferentes. Após isso, foi realizado uma MANOVA com o objetivo de visualizar se existe diferença entre os vetores de médias para ambos os sexos, e também foi rejeitada a hipótese de que elas são iguais. Dessa forma, queremos ver em qual medidas essas diferenças são mais acentuadas, portanto aplicamos um teste CBU.


```{r}
aux<-summary.aov(m.ajuste)
fit.modelLM <- lm(as.matrix(turtled) ~ sex)
#summary(fit.modelLM)


# Estimativa dos parâmetros
#xtable(estim.par.MRNLM(turtled,fit.modelLM,0.95)[,c(1,2,5,6)])
#estim.par.MRNLM(turtled,fit.modelLM,0.95)[,c(1,2,5,6)]
```

\begin{table}[ht]
\centering
\caption{Estimativas dos parâmetros do modelo}
\label{MRNLM}
\begin{tabular}{rrrrr}

  \hline
 & Estimativa & EP & Estatística t & p-valor \\ 
  \hline
$\mu_1$ & 136.00 & 3.51 & 38.79 & $<$ 0.0001 \\ 
  $\mu_2$ & 102.58 & 2.15 & 47.72 & $<$ 0.0001 \\ 
  $\mu_3$ & 51.96 & 1.27 & 40.78 & $<$ 0.0001 \\ 
 $\alpha_{21}$ & -22.63 & 4.96 & -4.56 & $<$ 0.0001 \\ 
  $\alpha_{22}$ & -14.29 & 3.04 & -4.70 & $<$ 0.0001 \\ 
  $\alpha_{23}$ & -11.25 & 1.80 & -6.24 & $<$ 0.0001 \\ 
   \hline
\end{tabular}
\end{table}



```{r}
m.C1 <- cbind(0,1) #  F X M
m.M = 0
p = 3
```


\begin{table}[ht]
\centering
\caption{Testes CBU ($\alpha_{2i} = 0$)}
\label{CBUtestes}
\begin{tabular}{rrr}

  \hline
 Parâmetro &  Estatística Qui-quadrado & p-valor \\ 
  \hline
 $\alpha_{21}$ (Length)  & 20.82 & $<$ 0.0001 \\ 
  $\alpha_{22}$ (Width) & 22.10 & $<$ 0.0001 \\
  $\alpha_{23}$ (Height) & 38.99 & $<$ 0.0001 \\
   \hline
\end{tabular}
\end{table}


```{r}
m.U <- rbind(1,0,0)
#Teste.CBU.M(fit.model,m.Sigma.P,p,G,m.C1,m.U,m.M)
```

```{r}
m.U <- rbind(0,1,0)
#Teste.CBU.M(fit.model,m.Sigma.P,p,G,m.C1,m.U,m.M)
```

```{r}
m.U <- rbind(0,0,1)
#Teste.CBU.M(fit.model,m.Sigma.P,p,G,m.C1,m.U,m.M)
```

Observando o resultado dos teste CBU, podemos observar que as diferenças estão em todas as medidas (largura, comprimento e altura).




Aqui eu não sei o que falar

OBS: DEPOIS TEM QUE VER A LISTA FEITA PRA VER SE FALTA ALGO


# Questão 2:
Questão 6 Lista 4
ACP

Dados

```{r}
hep = heptathlon[,1:7]
nvar <- 8
```
removido escore pelo fato de ser combinação das demais variaveis (resposta)
se fico em primeiro nos 200m ganho 500 pontos

## Análise descritiva

```{r}
SumHep<- cbind(round(apply(hep,2,mean),4),round(apply(hep,2,var),4),
                round(apply(hep,2,sd),4),
                round(100*apply(hep,2,sd)/apply(hep,2,mean),4),
                round(apply(hep,2,min),4),round(apply(hep,2,quantile,0.5),4),
                round(apply(hep,2,max),4),
                round(apply(hep,2,skewness),4),
                round(apply(hep,2,kurtosis),4))
colnames(SumHep)<-c("Média","Var.","DP","CV(%)","Min.","Med.","Max.",
                     "CA","Cur.")
#xtable(SumHep)
```

\begin{table}[ht]
\centering
\caption{Medidas resumo dos resultados}
\label{med_res2}
\begin{tabular}{rrrrrrrrrr}
  \hline
 & Média & Var. & DP & CV(\%) & Min. & Med. & Max. & CA & Cur. \\ 
  \hline
hurdles & 13.84 & 0.54 & 0.74 & 5.32 & 12.69 & 13.75 & 16.42 & 1.65 & 7.22 \\ 
  highjump & 1.78 & 0.01 & 0.08 & 4.37 & 1.50 & 1.80 & 1.86 & -1.99 & 7.87 \\ 
  shot & 13.12 & 2.23 & 1.49 & 11.37 & 10.00 & 12.88 & 16.23 & 0.18 & 2.78 \\ 
  run200m & 24.65 & 0.94 & 0.97 & 3.93 & 22.56 & 24.83 & 26.61 & -0.17 & 2.62 \\ 
  longjump & 6.15 & 0.22 & 0.47 & 7.71 & 4.88 & 6.25 & 7.27 & -0.48 & 4.28 \\ 
  javelin & 41.48 & 12.57 & 3.55 & 8.55 & 35.68 & 40.28 & 47.50 & 0.16 & 1.89 \\ 
  run800m & 136.05 & 68.74 & 8.29 & 6.09 & 124.20 & 134.74 & 163.43 & 1.40 & 5.89 \\ 
   \hline
\end{tabular}
\end{table}

2)Diagrama de dispersão

```{r,fig.cap="Matriz de gráfico de dispersões.\\label{disp2}"}
plot(hep,cex=1.5,cex.lab=1.5,pch=1)
```

```{r}
#xtable(cov(hep))
#cov(hep)
```

\begin{table}[ht]
\centering
\caption{Matriz de covariâncias}
\label{cov2}
\begin{tabular}{rrrrrrrr}
  \hline
 & hurdles & highjump & shot & run200m & longjump & javelin & run800m \\ 
  \hline
hurdles & 0.54 & -0.05 & -0.72 & 0.55 & -0.32 & -0.02 & 4.76 \\ 
  highjump & -0.05 & 0.01 & 0.05 & -0.04 & 0.03 & 0.00 & -0.38 \\ 
  shot & -0.72 & 0.05 & 2.23 & -0.99 & 0.53 & 1.42 & -5.19 \\ 
  run200m & 0.55 & -0.04 & -0.99 & 0.94 & -0.38 & -1.14 & 4.96 \\ 
  longjump & -0.32 & 0.03 & 0.53 & -0.38 & 0.22 & 0.11 & -2.75 \\ 
  javelin & -0.02 & 0.00 & 1.42 & -1.14 & 0.11 & 12.57 & 0.59 \\ 
  run800m & 4.76 & -0.38 & -5.19 & 4.96 & -2.75 & 0.59 & 68.74 \\ 
   \hline
\end{tabular}
\end{table}

```{r}
#xtable(cor(hep))
#cor(hep)
```

\begin{table}[ht]
\centering
\caption{Matriz de correlações}
\label{corr2}
\begin{tabular}{rrrrrrrr}
  \hline
 & hurdles & highjump & shot & run200m & longjump & javelin & run800m \\ 
  \hline
hurdles & 1.00 & -0.81 & -0.65 & 0.77 & -0.91 & -0.01 & 0.78 \\ 
  highjump & -0.81 & 1.00 & 0.44 & -0.49 & 0.78 & 0.00 & -0.59 \\ 
  shot & -0.65 & 0.44 & 1.00 & -0.68 & 0.74 & 0.27 & -0.42 \\ 
  run200m & 0.77 & -0.49 & -0.68 & 1.00 & -0.82 & -0.33 & 0.62 \\ 
  longjump & -0.91 & 0.78 & 0.74 & -0.82 & 1.00 & 0.07 & -0.70 \\ 
  javelin & -0.01 & 0.00 & 0.27 & -0.33 & 0.07 & 1.00 & 0.02 \\ 
  run800m & 0.78 & -0.59 & -0.42 & 0.62 & -0.70 & 0.02 & 1.00 \\ 
   \hline
\end{tabular}
\end{table}

5) Boxplot

```{r,fig.cap="Boxplots das variáveis.\\label{box2}"}
par(mfrow=c(2,4))
boxplot(hep[,1],cex=1.2,cex.lab=1.2,main="100m Barreiras")
boxplot(hep[,2],cex=1.2,cex.lab=1.2,main="Salto em altura")
boxplot(hep[,3],cex=1.2,cex.lab=1.2,main="Arremesso de peso")
boxplot(hep[,4],cex=1.2,cex.lab=1.2,main="200m rasos")
boxplot(hep[,5],cex=1.2,cex.lab=1.2,main="Salto em distância")
boxplot(hep[,6],cex=1.2,cex.lab=1.2,main="Lançamento dardos")
boxplot(hep[,7],cex=1.2,cex.lab=1.2,main="800m rasos")
#boxplot(hep[,8],cex=1.2,cex.lab=1.2,main="Pontuação total")
```

#histograms

```{r,fig.cap="Histogramas das variáveis.\\label{hist2}"}
par(mfrow=c(2,4))
hist(hep[,1],probability=TRUE,main="100m Barreiras",xlab="",ylab="")
hist(hep[,2],probability=TRUE,main="Salto em altura",xlab="",ylab="")
hist(hep[,3],probability=TRUE,main="Arremesso de peso",xlab="",ylab="")
hist(hep[,4],probability=TRUE,main="200m rasos",xlab="",ylab="")
hist(hep[,5],probability=TRUE,main="Salto em distância",xlab="",ylab="")
hist(hep[,6],probability=TRUE,main="Lançamento dardos",xlab="",ylab="")
hist(hep[,7],probability=TRUE,main="800m rasos",xlab="",ylab="")
#hist(hep[,8],probability=TRUE,main="Pontuação total",xlab="",ylab="")
```

# qqplots

```{r,fig.cap="QQplots das variáveis.\\label{qq2}"}
par(mfrow=c(2,4))
qqPlot(scale(hep[,1]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="100m Barreiras",cex=1.2) %>% invisible()
qqPlot(scale(hep[,2]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Salto em altura",cex=1.2) %>% invisible()
qqPlot(scale(hep[,3]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Arremesso de peso",cex=1.2) %>% invisible()
qqPlot(scale(hep[,4]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="200m rasos",cex=1.2) %>% invisible()
qqPlot(scale(hep[,5]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Salto em distância",cex=1.2) %>% invisible()
qqPlot(scale(hep[,6]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Lançamento dardos",cex=1.2) %>% invisible()
qqPlot(scale(hep[,7]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="800m rasos",cex=1.2) %>% invisible()
#qqPlot(scale(hep[,8]),dist="norm",mean=0,sd=1,col.lines=1,grid="FALSE",xlab="quantil da N(0,1)",ylab="Pontuação total",cex=1.2)
```

Análise inferencial

```{r,fig.cap="Correlograma das variáveis.\\label{correlo2}"}
corrplot(cor(hep), order = "hclust", tl.col='black', tl.cex=.75) 
```
## ACP


0 - Descritiva
1 - Suposições, dois grupos (variaveis tempo e distancia)
2 - ACP 2 comp 80%
3 - CP1 para o rank devido ao fato de fazer sentido com a direção das variáveis.
4 - Abordar novas classificações bem diferentes (12º->6º)


```{r}
p=7
m.cor<-cor(hep)
aut.val <-  eigen(m.cor)$values
aut.vec <- -(eigen(m.cor)$vectors)
m.aut.val <- t(matrix(((aut.val)),p,p))
result.cp.cor <- princomp(hep,cor=TRUE)

pca_importance <- function(x) {
  vars <- x$sdev^2
  vars <- vars/sum(vars)
  rbind(`PVE (%)` = vars*100, 
        `PVEA (%)` = cumsum(vars)*100)
}

#pca_importance(result.cp.cor)
#pca_importance(result.cp.cor) %>% xtable()

#corr.cp.var <- aut.vec*sqrt(m.aut.val)
#summary(result.cp.cor)$importance

screeplot(result.cp.cor,type=c("lines"),main="autovalores",cex=1.2,cex.lab=1.2,cex.main=1.2)

#result.cp.cor$loadings[1:7,1:2]
#xtable(result.cp.cor$loadings[1:7,1:2] %>% as.data.frame())

cp1 = result.cp.cor$loadings[,1]
```

\begin{table}[ht]
\centering
\caption{Variância Explicada}
\label{var_exp}
\begin{tabular}{rrrrrrrr}
  \hline
 & Comp.1 & Comp.2 & Comp.3 & Comp.4 & Comp.5 & Comp.6 & Comp.7 \\ 
  \hline
PVE (\%) & 63.72 & 17.06 & 7.44 & 6.53 & 3.50 & 1.04 & 0.70 \\ 
  PVEA (\%) & 63.72 & 80.78 & 88.22 & 94.75 & 98.26 & 99.30 & 100.00 \\ 
   \hline
\end{tabular}
\end{table}


\begin{table}[ht]
\centering
\caption{Componentes principais}
\label{comp2}
\begin{tabular}{rrr}
  \hline
 & Comp.1 & Comp.2 \\ 
  \hline
hurdles & 0.45 & 0.16 \\ 
  highjump & -0.38 & -0.25 \\ 
  shot & -0.36 & 0.29 \\ 
  run200m & 0.41 & -0.26 \\ 
  longjump & -0.46 & -0.06 \\ 
  javelin & -0.08 & 0.84 \\ 
  run800m & 0.37 & 0.22 \\ 
   \hline
\end{tabular}
\end{table}


Classificação
Escore da primeira componente principal.
acho q isso ta certo

```{r}
hep = scale(heptathlon[,1:7])
score_comp =result.cp.cor$loadings[1:7,1]
nominhos = row.names(hep)
escore = as.matrix(addmargins(cbind(hep[,1]*score_comp[1],hep[,2]*score_comp[2],hep[,3]*score_comp[3],hep[,4]*score_comp[4],hep[,5]*score_comp[5],hep[,6]*score_comp[6],hep[,7]*score_comp[7])))[1:25,8]
rankreal = c(seq(1,25,1))
hep_score = as.tibble(cbind(hep,rankreal,escore))
h_new_score = hep_score %>% arrange(escore)
ranknovo = c(seq(1,25,1))
h_new_score = cbind(h_new_score,ranknovo)[,8:10] 
h_new_score = h_new_score %>% mutate(escore = -escore)
row.names(h_new_score)<- nominhos
colnames(h_new_score)<-c("Classificação original","Escore","Novo rank")

#xtable(h_new_score[14:25,])

```


\begin{table}[ht]
\centering
\caption{Rankings e escores dos atletas}
\label{rank}
\begin{tabular}{r|r p{1cm} p{1cm}|r|r p{1cm} p{1cm}}
  \hline
 Atleta & Rank & Escore PCA & Novo rank & Atleta & Rank & Escore PCA & Novo rank\\ 
  \hline
Joyner-Kersee (USA) & 1 & 4.12 & 1 & Braun (FRG) & 14 & -0.00 & 14 \\ 
  John (GDR) & 2 & 2.88 & 2 & Ruotsalainen (FIN) & 13 & -0.02 & 15 \\ 
  Behmer (GDR) & 3 & 2.65 & 3 & Yuping (CHN) & 15 & -0.09 & 16 \\ 
  Sablovskaite (URS) & 5 & 1.36 & 4 & Hagger (GB) & 17 & -0.17 & 17 \\ 
  Choubenkova (URS) & 4 & 1.34 & 5 & Brown (USA) & 18 & -0.52 & 18 \\ 
  Schulz (GDR) & 12 & 1.19 & 6 & Mulliner (GB) & 20 & -1.09 & 19 \\ 
  Fleming (AUS) & 7 & 1.10 & 7 & Hautenauve (BEL) & 19 & -1.13 & 20 \\ 
  Greiner (USA) & 6 & 1.04 & 8 & Kytola (FIN) & 21 & -1.45 & 21 \\ 
  Lajbnerova (CZE) & 8 & 0.92 & 9 & Geremias (BRA) & 22 & -2.01 & 22 \\ 
  Bouraga (URS) & 10 & 0.76 & 10 & Hui-Ing (TAI) & 23 & -2.88 & 23 \\ 
  Wijnsma (HOL) & 11 & 0.56 & 11 & Jeong-Mi (KOR) & 24 & -2.97 & 24 \\ 
  Dimitrova (BUL) & 9 & 0.53 & 12 & Launa (PNG) & 25 & -6.27 & 25 \\ 
  Scheider (SWI) & 16 & 0.14 & 13 \\
   \hline
\end{tabular}
\end{table}





#Questão 3

##Introdução

Os dados são relacionados a um estudo sobre a relação entre status socioeconômico dos pais com  a condição de saúde mental de um total de 1760 indivíduos. A variável de status socioeconômico possui 5 níveis, de "A" (alto) até "E" (baixo) e a variável de saúde mental possui 4 níveis sendo, do melhor para o pior, "Boa", "Presença fraca de sintomas", "Presença moderada de sintomas" e "Debilitado".


##a) 

O modelo probabilístico gerador da tabela de contigência é uma multinomial de tamanho 1760 e 20 categorias.
```{r}
`Saúde mental`<- array(c(121,188,112,186,
                57,105,65,60,
                72,141,77,94,
                36,97,54,78,
                21,71,54,71),
 dim = c(4, 5), dimnames = list(`Saúde mental` = c("Boa","Presença fraca de sintomas","Presença moderada de sintomas","Debilitado"),
 ` Status socioeconômico dos pais` = c("A","B","C","D","E")))
#xtable(addmargins(`Saúde mental`))
#addmargins(`Saúde mental`)
chisq.test(`Saúde mental`)
```
\begin{table}[H]
\centering
\caption{Saúde Mental x Status Socioeconômico}
\begin{tabular}{r|rrrrr|r}
  \hline
  \multicolumn{7}{c}{Status Socioeconômico} \\
  \hline
Saúde Mental & A & B & C & D & E & Total \\ 
  \hline
Boa & 121.00 & 57.00 & 72.00 & 36.00 & 21.00 & 307.00 \\ 
  Presença fraca de sintomas & 188.00 & 105.00 & 141.00 & 97.00 & 71.00 & 602.00 \\ 
  Presença moderada de sintomas & 112.00 & 65.00 & 77.00 & 54.00 & 54.00 & 362.00 \\ 
  Debilitado & 186.00 & 60.00 & 94.00 & 78.00 & 71.00 & 489.00 \\ 
  \hline
Total & 607.00 & 287.00 & 384.00 & 265.00 & 217.00 & 1760.00 \\ 
   \hline
\end{tabular}
\end{table}


###Proporções estimadas (pelo total de observações) (× 100)

```{r}
margins = addmargins(`Saúde mental`)
#xtable(margins/1760*100)
```

\begin{table}[H]
\centering
\caption{Proporções estimadas ($\times$100).}
\begin{tabular}{r|rrrrr|r}
  \hline
  \multicolumn{7}{c}{\bf{Status Socioeconômico}} \\
  \hline
 \bf{Saúde Mental} & \bf{A} & \bf{B} & \bf{C} & \bf{D} & \bf{E} & \bf{Total} \\ 
  \hline
  Boa & 6.88 & 3.24 & 4.09 & 2.05 & 1.19 & 17.44 \\ 
  Presença fraca de sintomas & 10.68 & 5.97 & 8.01 & 5.51 & 4.03 & 34.20 \\ 
  Presença moderada de sintomas & 6.36 & 3.69 & 4.38 & 3.07 & 3.07 & 20.57 \\ 
  Debilitado & 10.57 & 3.41 & 5.34 & 4.43 & 4.03 & 27.78 \\ 
  Total & 34.49 & 16.31 & 21.82 & 15.06 & 12.33 & 100.00 \\ 
   \hline
\end{tabular}
\end{table}

###Perfil das linhas

```{r}
n = sum(`Saúde mental`)
linhas = `Saúde mental`
lin = dim(linhas)[1]
for (i in 1:lin){linhas[i,] = linhas[i,]/sum(linhas[i,])*100}
`Total` = c(sum(`Saúde mental`[,1]),sum(`Saúde mental`[,2]),sum(`Saúde mental`[,3]),sum(`Saúde mental`[,4]),sum(`Saúde mental`[,5]))/n*100
#xtable(addmargins(rbind(linhas,`Total`))[1:5,1:6])
#xtable(addmargins(rbind(linhas,`Total`))[1:5,1:6])
```
\begin{table}[H]
\centering
\caption{Perfil de Linhas ($\times$100).}
\begin{tabular}{r|rrrrr|r}
  \hline
  \multicolumn{7}{c}{\bf{Status Socioeconômico}} \\
  \hline
 \bf{Saúde Mental} & \bf{A} & \bf{B} & \bf{C} & \bf{D} & \bf{E} & \bf{Total} \\ 
  \hline
  Boa & \bf{39.41} & \bf{18.57} & \bf{23.45} & 11.73 & 6.84 & 100.00 \\ 
  Presença fraca de sintomas & \bf{31.23} & 17.44 & 23.42 & \bf{16.11} & 11.79 & 100.00 \\ 
  Presença moderada de sintomas & \bf{30.94} & 17.96 & 21.27 & 14.92 & \bf{14.92} & 100.00 \\ 
  Debilitado & \bf{38.04} & 12.27 & 19.22 & 15.95 & 14.52 & 100.00 \\ 
  Total & \bf{34.49} & 16.31 & 21.82 & 15.06 & 12.33 & 100.00 \\ 
   \hline
\end{tabular}
\end{table}

###Perfil das Colunas

```{r}
n = sum(`Saúde mental`)
colunas = `Saúde mental`
col = dim(linhas)[2]
for (i in 1:col){colunas[,i] = colunas[,i]/sum(colunas[,i])*100}
`Total` = c(sum(`Saúde mental`[1,]),sum(`Saúde mental`[2,]),sum(`Saúde mental`[3,]),sum(`Saúde mental`[4,]))/n*100
#xtable(addmargins(rbind(colunas,`Total`))[1:5,1:6])
#xtable(addmargins(cbind(colunas,`Total`))[1:5,1:6])
```
\begin{table}[H]
\centering
\caption{Perfil de Colunas ($\times$100).}
\begin{tabular}{r|rrrrr|r}
  \hline
  \multicolumn{7}{c}{\bf{Status Socioeconômico}} \\
  \hline
 \bf{Saúde Mental} & \bf{A} & \bf{B} & \bf{C} & \bf{D} & \bf{E} & \bf{Total} \\ 
  \hline
Boa & \bf{19.93} & 19.86 & 18.75 & 13.58 & 9.68 & 17.44 \\ 
  Presença fraca de sintomas & \bf{30.97} & \bf{36.59} & \bf{36.72} & \bf{36.60} & \bf{32.72} & 34.20 \\ 
  Presença moderada de sintomas & 18.45 & 22.65 & 20.05 & 20.38 & \bf{24.88} & 20.57 \\ 
  Debilitado & 30.64 & 20.91 & 24.48 & 29.43 & \bf{32.72} & 27.78 \\ 
  Total & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 & 100.00 \\ 
   \hline
\end{tabular}
\end{table}
Análise de corresponcência

```{r}
resultCA <- ca(`Saúde mental`) # names(resultCA)
inercia<-summary(resultCA)$scree # names(summary(resultCA))
#xtable(cbind(sqrt(inercia[,2]), inercia[,2],inercia[,3],inercia[,4]),digits=4)
```

\begin{table}[ht]
\centering
\begin{tabular}{rrrrr}
  \hline
 & 1 & 2 & 3 & 4 \\ 
  \hline
  1 & 0.1023 & 0.0105 & 59.0863 & 59.0863 \\ 
  2 & 0.0797 & 0.0064 & 35.8758 & 94.9621 \\ 
  3 & 0.0299 & 0.0009 & 5.0379 & 100.0000 \\ 
   \hline
\end{tabular}
\end{table}

```{r,fig.cap="Bi-Plot.\\label{biplot3}", fig.height=4.5}

# Componentes
resultFCA <- plot(resultCA,xlab="componente 1",ylab="componente 2",
                  cex=1.4,cex.lab=1.2) #Biplot
#
#xtable(resultFCA$rows,digits=4)
#xtable(resultFCA$cols,digits=4)

```


\begin{table}[H]
\centering
\begin{tabular}{rrr}
  \hline
 & Dim1 & Dim2 \\ 
  \hline
Boa & 0.1923 & 0.0773 \\ 
  Presença fraca de sintomas & 0.0202 & -0.0676 \\ 
  Presença moderada de sintomas & -0.0467 & -0.0797 \\ 
  Debilitado & -0.1111 & 0.0937 \\ 
   \hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\begin{tabular}{rrr}
  \hline
 & Dim1 & Dim2 \\ 
  \hline
A & 0.0191 & 0.1064 \\ 
  B & 0.1153 & -0.0984 \\ 
  C & 0.0678 & -0.0423 \\ 
  D & -0.0848 & -0.0365 \\ 
  E & -0.2222 & -0.0479 \\ 
   \hline
\end{tabular}
\end{table}



Classe A está mais relacionada com saúde mental debilitada que as demais.
Classes B e C estão mais relacionadas com presença fraca
Classe D está mais relacionada à presença moderada
Classe E está mais longe da saúde mental BOA





